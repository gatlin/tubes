<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Tubes</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Tubes.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">tubes-0.2.2.3: Effectful, iteratee-inspired stream processing based on a
free monad.</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Copyright</th><td>(c) 2014, 2015 Gatlin Johnson &lt;gatlin@niltag.net&gt;</td></tr><tr><th>License</th><td>GPL-3</td></tr><tr><th>Maintainer</th><td>gatlin@niltag.net</td></tr><tr><th>Stability</th><td>experimental</td></tr><tr><th>Safe Haskell</th><td>Safe</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Tubes</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Core infrastructure</a></li><li><a href="#g:2">Utilities</a></li><li><a href="#g:3">Pump</a></li><li><a href="#g:4">Re-exports</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Write effect-ful stream processing functions and compose them into a series of
tubes.</p><p>This exists primarily for my own education. It is updated often as I try
things and is probably, at this moment, wrong.</p><p>My goals were to</p><ul><li>learn more about iteratees and stream processing; and</li><li>explore the relationships between functions, pairs, sum types, and products.</li></ul></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">type</span> <a href="#t:Tube">Tube</a> a b = FreeT (<a href="Tubes.html#t:TubeF">TubeF</a> a b)</li><li class="src short"><span class="keyword">newtype</span> <a href="#t:TubeF">TubeF</a> a b k = <a href="#v:TubeF">TubeF</a> {<ul class="subs"><li><a href="#v:runT">runT</a> :: <span class="keyword">forall</span> r. ((a -&gt; k) -&gt; r) -&gt; ((b, k) -&gt; r) -&gt; r</li></ul>}</li><li class="src short"><span class="keyword">type</span> <a href="#t:Source">Source</a> b m r = <span class="keyword">forall</span> x. <a href="Tubes.html#t:Tube">Tube</a> x b m r</li><li class="src short"><span class="keyword">type</span> <a href="#t:Sink">Sink</a> a m r = <span class="keyword">forall</span> x. <a href="Tubes.html#t:Tube">Tube</a> a x m r</li><li class="src short"><a href="#v:run">run</a> :: FreeT f m a -&gt; m (FreeF f a (FreeT f m a))</li><li class="src short"><a href="#v:await">await</a> :: <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="Tubes.html#t:Tube">Tube</a> a b m a</li><li class="src short"><a href="#v:yield">yield</a> :: <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; b -&gt; <a href="Tubes.html#t:Tube">Tube</a> a b m ()</li><li class="src short"><a href="#v:each">each</a> :: (<a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m, <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Data-Foldable.html#t:Foldable">Foldable</a> t) =&gt; t b -&gt; <a href="Tubes.html#t:Tube">Tube</a> a b m ()</li><li class="src short"><a href="#v:for">for</a> :: <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="Tubes.html#t:Tube">Tube</a> a b m r -&gt; (b -&gt; <a href="Tubes.html#t:Tube">Tube</a> a c m s) -&gt; <a href="Tubes.html#t:Tube">Tube</a> a c m r</li><li class="src short"><a href="#v:-126--62-">(~&gt;)</a> :: <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="Tubes.html#t:Tube">Tube</a> a b m r -&gt; (b -&gt; <a href="Tubes.html#t:Tube">Tube</a> a c m s) -&gt; <a href="Tubes.html#t:Tube">Tube</a> a c m r</li><li class="src short"><a href="#v:-62--45-">(&gt;-)</a> :: <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="Tubes.html#t:Tube">Tube</a> a b m r -&gt; (b -&gt; <a href="Tubes.html#t:Tube">Tube</a> b c m r) -&gt; <a href="Tubes.html#t:Tube">Tube</a> a c m r</li><li class="src short"><a href="#v:-62--60-">(&gt;&lt;)</a> :: <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="Tubes.html#t:Tube">Tube</a> a b m r -&gt; <a href="Tubes.html#t:Tube">Tube</a> b c m r -&gt; <a href="Tubes.html#t:Tube">Tube</a> a c m r</li><li class="src short"><a href="#v:-124--62-">(|&gt;)</a> :: <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="Tubes.html#t:Tube">Tube</a> x b m r -&gt; <a href="Tubes.html#t:Sink">Sink</a> (<a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Data-Maybe.html#t:Maybe">Maybe</a> b) m s -&gt; <a href="Tubes.html#t:Sink">Sink</a> (<a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Data-Maybe.html#t:Maybe">Maybe</a> b) m s</li><li class="src short"><a href="#v:-45--60-">(-&lt;)</a> :: <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; a -&gt; <a href="Tubes.html#t:Sink">Sink</a> a m b -&gt; <a href="Tubes.html#t:Sink">Sink</a> a m b</li><li class="src short"><a href="#v:liftT">liftT</a> :: (<a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/transformers-0.4.2.0/Control-Monad-Trans-Class.html#t:MonadTrans">MonadTrans</a> t, <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m) =&gt; FreeT f m a -&gt; t m (FreeF f a (FreeT f m a))</li><li class="src short"><a href="#v:cat">cat</a> :: <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="Tubes.html#t:Tube">Tube</a> a a m r</li><li class="src short"><a href="#v:map">map</a> :: <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; (a -&gt; b) -&gt; <a href="Tubes.html#t:Tube">Tube</a> a b m r</li><li class="src short"><a href="#v:drop">drop</a> :: <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="Tubes.html#t:Tube">Tube</a> a a m r</li><li class="src short"><a href="#v:take">take</a> :: <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="Tubes.html#t:Tube">Tube</a> a a m ()</li><li class="src short"><a href="#v:takeWhile">takeWhile</a> :: <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; (a -&gt; <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Data-Bool.html#t:Bool">Bool</a>) -&gt; <a href="Tubes.html#t:Tube">Tube</a> a a m ()</li><li class="src short"><a href="#v:filter">filter</a> :: <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; (a -&gt; <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Data-Bool.html#t:Bool">Bool</a>) -&gt; <a href="Tubes.html#t:Tube">Tube</a> a a m r</li><li class="src short"><a href="#v:reduce">reduce</a> :: <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; (x -&gt; a -&gt; x) -&gt; x -&gt; (x -&gt; b) -&gt; <a href="Tubes.html#t:Source">Source</a> a m () -&gt; m b</li><li class="src short"><a href="#v:every">every</a> :: (<a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Data-Foldable.html#t:Foldable">Foldable</a> t, <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m) =&gt; t b -&gt; <a href="Tubes.html#t:Tube">Tube</a> a (<a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Data-Maybe.html#t:Maybe">Maybe</a> b) m ()</li><li class="src short"><a href="#v:unyield">unyield</a> :: <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; FreeT (<a href="Tubes.html#t:TubeF">TubeF</a> x b) m () -&gt; m (<a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Data-Maybe.html#t:Maybe">Maybe</a> (b, FreeT (<a href="Tubes.html#t:TubeF">TubeF</a> x b) m ()))</li><li class="src short"><a href="#v:prompt">prompt</a> :: <a href="Tubes.html#t:Source">Source</a> <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Data-String.html#t:String">String</a> <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/System-IO.html#t:IO">IO</a> ()</li><li class="src short"><a href="#v:display">display</a> :: <a href="Tubes.html#t:Sink">Sink</a> <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Data-String.html#t:String">String</a> <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/System-IO.html#t:IO">IO</a> ()</li><li class="src short"><span class="keyword">type</span> <a href="#t:Pump">Pump</a> a b = CofreeT (<a href="Tubes.html#t:PumpF">PumpF</a> a b)</li><li class="src short"><span class="keyword">data</span> <a href="#t:PumpF">PumpF</a> a b k = <a href="#v:PumpF">PumpF</a> {<ul class="subs"><li><a href="#v:recvF">recvF</a> :: (a, k)</li><li><a href="#v:sendF">sendF</a> :: b -&gt; k</li></ul>}</li><li class="src short"><a href="#v:pump">pump</a> :: Comonad w =&gt; w a -&gt; (w a -&gt; (b, w a)) -&gt; (w a -&gt; c -&gt; w a) -&gt; <a href="Tubes.html#t:Pump">Pump</a> b c w a</li><li class="src short"><a href="#v:send">send</a> :: Comonad w =&gt; <a href="Tubes.html#t:Pump">Pump</a> a b w r -&gt; b -&gt; <a href="Tubes.html#t:Pump">Pump</a> a b w r</li><li class="src short"><a href="#v:recv">recv</a> :: Comonad w =&gt; <a href="Tubes.html#t:Pump">Pump</a> a b w r -&gt; (a, <a href="Tubes.html#t:Pump">Pump</a> a b w r)</li><li class="src short"><a href="#v:runPump">runPump</a> :: (Comonad w, <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m) =&gt; (x -&gt; y -&gt; r) -&gt; <a href="Tubes.html#t:Pump">Pump</a> a b w x -&gt; <a href="Tubes.html#t:Tube">Tube</a> a b m y -&gt; m r</li><li class="src short"><a href="#v:lift">lift</a> :: <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/transformers-0.4.2.0/Control-Monad-Trans-Class.html#t:MonadTrans">MonadTrans</a> t =&gt; <span class="keyword">forall</span> m a. <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; m a -&gt; t m a</li><li class="src short"><a href="#v:runFreeT">runFreeT</a> :: FreeT f m a -&gt; m (FreeF f a (FreeT f m a))</li></ul></div><div id="interface"><h1>Documentation</h1><div class="doc"><p>A <code><a href="Tubes.html#t:Tube">Tube</a></code> is a computation that can yield multiple intermediate values or await
intermediate inputs before computing a final result. Any monadic function may
be turned into a <code><a href="Tubes.html#t:Tube">Tube</a></code>.</p><p><code><a href="Tubes.html#t:Tube">Tube</a></code>s may be composed in different ways. For instance, in ghci:</p><pre>   &gt;&gt;&gt; run $ for (each [1..4] &gt;&lt; map show) $ lift . putStrLn
   1
   2
   3
   4
   </pre><p>Here, <code><a href="Tubes.html#v:each">each</a></code> converts an <code><a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Data-Foldable.html#t:Foldable">Foldable</a></code> into a <code><a href="Tubes.html#t:Source">Source</a></code> of values; <code><a href="Tubes.html#v:for">for</a></code> performs
a computation with each value. Another example, using two built-in <code><a href="Tubes.html#t:Tube">Tube</a></code>s for
convenience:</p><pre>   &gt;&gt;&gt; run $ prompt &gt;&lt; filter (/= &quot;Die Antwoord&quot;) &gt;&lt; map (++ &quot; is bad&quot;) &gt;&lt; print
   &gt; dubstep
   dubstep is bad
   &gt; the sun
   the sun is bad
   &gt; Die Antwoord
   &gt; this example
   this example is bad
   </pre><p>A few stream processing combinators are provided for mapping, filtering,
taking, and other basic operations.</p><p>For those times when you want to <code><a href="Tubes.html#v:reduce">reduce</a></code> a stream, you can like so:</p><pre>   &gt;&gt;&gt; reduce (+) 0 id (each [1..10])
   55
   </pre><p><code><a href="Tubes.html#v:-62--60-">&gt;&lt;</a></code> is useful for combining <code><a href="Tubes.html#t:Tube">Tube</a></code>s which all have the same return value -
most often <code>()</code> simply because every <code><a href="Tubes.html#t:Source">Source</a></code> will have that value.</p><p>There is more in the library not covered here, and you are encouraged to take
a look around.</p></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:Tube" class="def">Tube</a> a b = FreeT (<a href="Tubes.html#t:TubeF">TubeF</a> a b)</p><div class="doc"><p>A <code><a href="Tubes.html#t:Tube">Tube</a></code> is a computation which can</p><ul><li><code><a href="Tubes.html#v:yield">yield</a></code> an intermediate value downstream and suspend execution; and</li><li><code><a href="Tubes.html#v:await">await</a></code> a value from upstream, deferring execution until it is received.</li></ul><p>Moreover, individual <code><a href="Tubes.html#t:Tube">Tube</a></code>s may be freely composed into larger ones, so long
as their types match. Thus, one may write small, reusable building blocks and
construct efficient stream process pipelines.</p><p>Since a much better engineered, more popular, and decidedly more mature
library already uses the term &quot;pipes&quot; I have opted instead to think of my work
as a series of tubes.</p></div></div><div class="top"><p class="src"><span class="keyword">newtype</span> <a name="t:TubeF" class="def">TubeF</a> a b k</p><div class="doc"><p><code><a href="Tubes.html#t:TubeF">TubeF</a></code> is the union of unary functions and binary products into a single
type, here defined with a Boehm-Berarducci encoding.</p><p>This type is equivalent to the following:</p><pre>       data TubeF a b k
           = Await (a -&gt; k) -- :: (a -&gt; k) -&gt; TubeF a b k
           | Yield (b  , k) -- :: (b  , k) -&gt; TubeF a b k
   </pre><p>The type signatures for the two value constructors should bear a strong
resemblance to the actual type signature of <code><a href="Tubes.html#v:runT">runT</a></code>. Instead of encoding
tubes as structures which build up when composed, a <code><a href="Tubes.html#t:TubeF">TubeF</a></code> is a control
flow mechanism which picks one of two provided continuations.</p><p>People using this library should never have to contend with these details
but it is worth mentioning.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:TubeF" class="def">TubeF</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:runT" class="def">runT</a> :: <span class="keyword">forall</span> r. ((a -&gt; k) -&gt; r) -&gt; ((b, k) -&gt; r) -&gt; r</dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div><div class="subs instances"><p id="control.i:TubeF" class="caption collapser" onclick="toggleSection('i:TubeF')">Instances</p><div id="section.i:TubeF" class="show"><table><tr><td class="src"><a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Data-Functor.html#t:Functor">Functor</a> (<a href="Tubes.html#t:TubeF">TubeF</a> a b)</td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:Source" class="def">Source</a> b m r = <span class="keyword">forall</span> x. <a href="Tubes.html#t:Tube">Tube</a> x b m r</p><div class="doc"><p>A computation which only <code><a href="Tubes.html#v:yield">yield</a></code>s and never <code><a href="Tubes.html#v:await">await</a></code>s</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:Sink" class="def">Sink</a> a m r = <span class="keyword">forall</span> x. <a href="Tubes.html#t:Tube">Tube</a> a x m r</p><div class="doc"><p>A computation which only <code><a href="Tubes.html#v:await">await</a></code>s and never <code><a href="Tubes.html#v:yield">yield</a></code>s.</p></div></div><h1 id="g:1">Core infrastructure</h1><div class="top"><p class="src"><a name="v:run" class="def">run</a> :: FreeT f m a -&gt; m (FreeF f a (FreeT f m a))</p><div class="doc"><p><code><a href="Tubes.html#v:run">run</a></code> is shorter than <code><a href="Tubes.html#v:runFreeT">runFreeT</a></code> and who knows, maybe it'll change some
 day</p></div></div><div class="top"><p class="src"><a name="v:await" class="def">await</a> :: <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="Tubes.html#t:Tube">Tube</a> a b m a</p><div class="doc"><p>Command to wait for a new value upstream</p></div></div><div class="top"><p class="src"><a name="v:yield" class="def">yield</a> :: <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; b -&gt; <a href="Tubes.html#t:Tube">Tube</a> a b m ()</p><div class="doc"><p>Command to send a value downstream</p></div></div><div class="top"><p class="src"><a name="v:each" class="def">each</a> :: (<a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m, <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Data-Foldable.html#t:Foldable">Foldable</a> t) =&gt; t b -&gt; <a href="Tubes.html#t:Tube">Tube</a> a b m ()</p><div class="doc"><p>Convert a list to a <code><a href="Tubes.html#t:Source">Source</a></code></p></div></div><div class="top"><p class="src"><a name="v:for" class="def">for</a> :: <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="Tubes.html#t:Tube">Tube</a> a b m r -&gt; (b -&gt; <a href="Tubes.html#t:Tube">Tube</a> a c m s) -&gt; <a href="Tubes.html#t:Tube">Tube</a> a c m r</p><div class="doc"><p>Enumerate <code><a href="Tubes.html#v:yield">yield</a></code>ed values into a continuation, creating a new <code><a href="Tubes.html#t:Source">Source</a></code></p></div></div><div class="top"><p class="src"><a name="v:-126--62-" class="def">(~&gt;)</a> :: <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="Tubes.html#t:Tube">Tube</a> a b m r -&gt; (b -&gt; <a href="Tubes.html#t:Tube">Tube</a> a c m s) -&gt; <a href="Tubes.html#t:Tube">Tube</a> a c m r</p><div class="doc"><p>Infix version of <code><a href="Tubes.html#v:for">for</a></code></p></div></div><div class="top"><p class="src"><a name="v:-62--45-" class="def">(&gt;-)</a> :: <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="Tubes.html#t:Tube">Tube</a> a b m r -&gt; (b -&gt; <a href="Tubes.html#t:Tube">Tube</a> b c m r) -&gt; <a href="Tubes.html#t:Tube">Tube</a> a c m r</p><div class="doc"><p>Connect a task to a continuation yielding another task; see <code><a href="Tubes.html#v:-62--60-">&gt;&lt;</a></code></p></div></div><div class="top"><p class="src"><a name="v:-62--60-" class="def">(&gt;&lt;)</a> :: <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="Tubes.html#t:Tube">Tube</a> a b m r -&gt; <a href="Tubes.html#t:Tube">Tube</a> b c m r -&gt; <a href="Tubes.html#t:Tube">Tube</a> a c m r <span class="fixity">infixl 3</span><span class="rightedge"></span></p><div class="doc"><p>Compose two tubes into a new tube.</p></div></div><div class="top"><p class="src"><a name="v:-124--62-" class="def">(|&gt;)</a> :: <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="Tubes.html#t:Tube">Tube</a> x b m r -&gt; <a href="Tubes.html#t:Sink">Sink</a> (<a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Data-Maybe.html#t:Maybe">Maybe</a> b) m s -&gt; <a href="Tubes.html#t:Sink">Sink</a> (<a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Data-Maybe.html#t:Maybe">Maybe</a> b) m s</p><div class="doc"><p>Connects a <code><a href="Tubes.html#t:Source">Source</a></code> to a <code><a href="Tubes.html#t:Sink">Sink</a></code>, finishing when either the <code><a href="Tubes.html#t:Source">Source</a></code> is
exhausted or the <code><a href="Tubes.html#t:Sink">Sink</a></code> terminates.</p></div></div><div class="top"><p class="src"><a name="v:-45--60-" class="def">(-&lt;)</a> :: <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; a -&gt; <a href="Tubes.html#t:Sink">Sink</a> a m b -&gt; <a href="Tubes.html#t:Sink">Sink</a> a m b</p><div class="doc"><p>Insert a value into a <code><a href="Tubes.html#t:Sink">Sink</a></code></p></div></div><div class="top"><p class="src"><a name="v:liftT" class="def">liftT</a> :: (<a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/transformers-0.4.2.0/Control-Monad-Trans-Class.html#t:MonadTrans">MonadTrans</a> t, <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m) =&gt; FreeT f m a -&gt; t m (FreeF f a (FreeT f m a))</p><div class="doc"><p>This performs a neat trick: a <code><a href="Tubes.html#t:Tube">Tube</a></code> with a return type <code>a</code> will be
turned into a new <code><a href="Tubes.html#t:Tube">Tube</a></code> containing the underlying <code><a href="Tubes.html#t:TubeF">TubeF</a></code> value.</p><p>In this way the <code><a href="Tubes.html#v:-62--60-">&gt;&lt;</a></code> and <code><a href="Tubes.html#v:-62--45-">&gt;-</a></code> functions can replace the <code>()</code> return value with
a continuation and recursively traverse the computation until a final result
is reached.</p></div></div><h1 id="g:2">Utilities</h1><div class="top"><p class="src"><a name="v:cat" class="def">cat</a> :: <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="Tubes.html#t:Tube">Tube</a> a a m r</p><div class="doc"><p>Continuously relays any values it receives. Iteratee identity.</p></div></div><div class="top"><p class="src"><a name="v:map" class="def">map</a> :: <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; (a -&gt; b) -&gt; <a href="Tubes.html#t:Tube">Tube</a> a b m r</p><div class="doc"><p>Transforms all incoming values according to some function.</p></div></div><div class="top"><p class="src"><a name="v:drop" class="def">drop</a> :: <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="Tubes.html#t:Tube">Tube</a> a a m r</p><div class="doc"><p>Refuses to yield the first <code>n</code> values it receives.</p></div></div><div class="top"><p class="src"><a name="v:take" class="def">take</a> :: <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="Tubes.html#t:Tube">Tube</a> a a m ()</p><div class="doc"><p>Relay only the first <code>n</code> elements of a stream.</p></div></div><div class="top"><p class="src"><a name="v:takeWhile" class="def">takeWhile</a> :: <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; (a -&gt; <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Data-Bool.html#t:Bool">Bool</a>) -&gt; <a href="Tubes.html#t:Tube">Tube</a> a a m ()</p><div class="doc"><p>Terminates the stream upon receiving a value violating the predicate</p></div></div><div class="top"><p class="src"><a name="v:filter" class="def">filter</a> :: <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; (a -&gt; <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Data-Bool.html#t:Bool">Bool</a>) -&gt; <a href="Tubes.html#t:Tube">Tube</a> a a m r</p><div class="doc"><p>Yields only values satisfying some predicate.</p></div></div><div class="top"><p class="src"><a name="v:reduce" class="def">reduce</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; (x -&gt; a -&gt; x)</td><td class="doc"><p>step function</p></td></tr><tr><td class="src">-&gt; x</td><td class="doc"><p>initial value</p></td></tr><tr><td class="src">-&gt; (x -&gt; b)</td><td class="doc"><p>final transformation</p></td></tr><tr><td class="src">-&gt; <a href="Tubes.html#t:Source">Source</a> a m ()</td><td class="doc"><p>stream source</p></td></tr><tr><td class="src">-&gt; m b</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Strict left-fold of a stream. Note that the actual return type of the source
is not relevant, only the intermediate yield type.</p></div></div><div class="top"><p class="src"><a name="v:every" class="def">every</a> :: (<a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Data-Foldable.html#t:Foldable">Foldable</a> t, <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m) =&gt; t b -&gt; <a href="Tubes.html#t:Tube">Tube</a> a (<a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Data-Maybe.html#t:Maybe">Maybe</a> b) m ()</p><div class="doc"><p>Similar to <code><a href="Tubes.html#v:each">each</a></code> except it explicitly marks the stream as exhausted</p></div></div><div class="top"><p class="src"><a name="v:unyield" class="def">unyield</a> :: <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; FreeT (<a href="Tubes.html#t:TubeF">TubeF</a> x b) m () -&gt; m (<a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Data-Maybe.html#t:Maybe">Maybe</a> (b, FreeT (<a href="Tubes.html#t:TubeF">TubeF</a> x b) m ()))</p><div class="doc"><p>Taps the next value from a source, maybe.</p></div></div><div class="top"><p class="src"><a name="v:prompt" class="def">prompt</a> :: <a href="Tubes.html#t:Source">Source</a> <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Data-String.html#t:String">String</a> <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/System-IO.html#t:IO">IO</a> ()</p><div class="doc"><p>Source of <code><a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Data-String.html#t:String">String</a></code>s from stdin. This is mostly for debugging / ghci example purposes.</p></div></div><div class="top"><p class="src"><a name="v:display" class="def">display</a> :: <a href="Tubes.html#t:Sink">Sink</a> <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Data-String.html#t:String">String</a> <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/System-IO.html#t:IO">IO</a> ()</p><div class="doc"><p>Sink for <code><a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Data-String.html#t:String">String</a></code>s to stdout. This is mostly for debugging / ghci example
 purposes.</p></div></div><h1 id="g:3">Pump</h1><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:Pump" class="def">Pump</a> a b = CofreeT (<a href="Tubes.html#t:PumpF">PumpF</a> a b)</p><div class="doc"><p>A <code><a href="Tubes.html#t:Pump">Pump</a></code> is the dual to a <code><a href="Tubes.html#t:Tube">Tube</a></code>: where a <code><a href="Tubes.html#t:Tube">Tube</a></code> is a computation manipulating
a stream of values, a <code><a href="Tubes.html#t:Pump">Pump</a></code> can be situated on either end of a tube to both
insert values when requested and handle any yielded results.</p><p>One interesting use of a <code><a href="Tubes.html#t:Pump">Pump</a></code> is to feed data to a <code><a href="Tubes.html#t:Tube">Tube</a></code>, collecting the
result as well as unused input:</p><pre>   import Data.Functor.Identity

   p :: [a] -&gt; Pump (Maybe a) x Identity [a]
   p inp = pump (return inp)
           (wa -&gt; case (extract wa) of
               [] -&gt; (Nothing, wa)
               x:xs -&gt; (Just x, return xs))
           const

   -- a <code><a href="Tubes.html#t:Sink">Sink</a></code> that stops after 5 loops, or when input is exhausted
   add5 :: Sink (Maybe Int) IO Int
   add5 = loop 0 5 where
       loop acc ct = if 0 == ct
           then return acc
           else do
               mn &lt;- await
               maybe (return acc)
                     (n -&gt; loop (acc+n) (ct - 1))
                     mn

   result :: IO ([Int], Int)
   result = runPump (curry id) (p [1..10]) add5
   -- ([6,7,8,9,10],15)
   </pre><p><code><a href="Tubes.html#t:Pump">Pump</a></code>s are still being investigated by the author so if you come up with
something interesting, please share!</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:PumpF" class="def">PumpF</a> a b k</p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:PumpF" class="def">PumpF</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:recvF" class="def">recvF</a> :: (a, k)</dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:sendF" class="def">sendF</a> :: b -&gt; k</dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div><div class="subs instances"><p id="control.i:PumpF" class="caption collapser" onclick="toggleSection('i:PumpF')">Instances</p><div id="section.i:PumpF" class="show"><table><tr><td class="src"><a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Data-Functor.html#t:Functor">Functor</a> (<a href="Tubes.html#t:PumpF">PumpF</a> a b)</td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><a name="v:pump" class="def">pump</a> :: Comonad w =&gt; w a -&gt; (w a -&gt; (b, w a)) -&gt; (w a -&gt; c -&gt; w a) -&gt; <a href="Tubes.html#t:Pump">Pump</a> b c w a</p><div class="doc"><p>Creates a <code><a href="Tubes.html#t:Pump">Pump</a></code> for a <code><a href="Tubes.html#t:Tube">Tube</a></code> using a comonadic seed value, a function to give
it more data upon request, and a function to handle any yielded results.</p><p>Values received from the <code><a href="Tubes.html#t:Tube">Tube</a></code> may be altered and sent back into the tube,
hence this mechanism does act like something of a pump.</p></div></div><div class="top"><p class="src"><a name="v:send" class="def">send</a> :: Comonad w =&gt; <a href="Tubes.html#t:Pump">Pump</a> a b w r -&gt; b -&gt; <a href="Tubes.html#t:Pump">Pump</a> a b w r</p><div class="doc"><p>Send a value into a <code><a href="Tubes.html#t:Pump">Pump</a></code>, effectively re-seeding the stream.</p></div></div><div class="top"><p class="src"><a name="v:recv" class="def">recv</a> :: Comonad w =&gt; <a href="Tubes.html#t:Pump">Pump</a> a b w r -&gt; (a, <a href="Tubes.html#t:Pump">Pump</a> a b w r)</p><div class="doc"><p>Pull a value from a <code><a href="Tubes.html#t:Pump">Pump</a></code>, along with the rest of the <code><a href="Tubes.html#t:Pump">Pump</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:runPump" class="def">runPump</a> :: (Comonad w, <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m) =&gt; (x -&gt; y -&gt; r) -&gt; <a href="Tubes.html#t:Pump">Pump</a> a b w x -&gt; <a href="Tubes.html#t:Tube">Tube</a> a b m y -&gt; m r</p><div class="doc"><p>Given a suitably matching <code><a href="Tubes.html#t:Tube">Tube</a></code> and <code><a href="Tubes.html#t:Pump">Pump</a></code>, you can use the latter to execute
the former.</p></div></div><h1 id="g:4">Re-exports</h1><div class="top"><p class="src"><a name="v:lift" class="def">lift</a> :: <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/transformers-0.4.2.0/Control-Monad-Trans-Class.html#t:MonadTrans">MonadTrans</a> t =&gt; <span class="keyword">forall</span> m a. <a href="file:///usr/local/Cellar/ghc/7.10.1/share/doc/ghc/html/libraries/base-4.8.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; m a -&gt; t m a</p><div class="doc"><p>Lift a computation from the argument monad to the constructed monad.</p></div></div><div class="top"><p class="src"><a name="v:runFreeT" class="def">runFreeT</a> :: FreeT f m a -&gt; m (FreeF f a (FreeT f m a))</p></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.16.0</p></div></body></html>